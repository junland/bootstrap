# Binaries

mkdir -vp ${STRAP_ROOTFS}/usr/bin ${STRAP_ROOTFS}/etc ${STRAP_ROOTFS}/usr ${STRAP_ROOTFS}/var

for bfile in awk bash cat dd echo env file grep ln ls pwd rm sed sh stty install
do
    msg "Linking /tools/bin/${bfile} to ${STRAP_ROOTFS}/usr/bin/${bfile}"
    ln -sf "/tools/bin/${bfile}" "${STRAP_ROOTFS}/usr/bin/${bfile}"
done

ln -sf /usr/bin/gcc        "${STRAP_ROOTFS}/tools/bin/cc"
ln -sf /proc/self/mounts   "${STRAP_ROOTFS}/etc/mtab"

# libraries
ln -sf /tools/usr/lib/libgcc_s.so         "${STRAP_ROOTFS}/usr/lib"
ln -sf /tools/usr/lib/libgcc_s.so.1       "${STRAP_ROOTFS}/usr/lib"

ln -sf /tools/usr/lib/libstdc++.so        "${STRAP_ROOTFS}/usr/lib"
ln -sf /tools/usr/lib/libstdc++.so.6      "${STRAP_ROOTFS}/usr/lib"
ln -sf /tools/usr/lib/libstdc++.a         "${STRAP_ROOTFS}/usr/lib"

ln -sf /tools/usr/lib/libssp.so           "${STRAP_ROOTFS}/usr/lib"
ln -sf /tools/usr/lib/libssp.so.0         "${STRAP_ROOTFS}/usr/lib"
ln -sf /tools/usr/lib/libssp.so.0.0.0     "${STRAP_ROOTFS}/usr/lib"
ln -sf /tools/usr/lib/libssp.a            "${STRAP_ROOTFS}/usr/lib"
ln -sf /tools/usr/lib/libssp_nonshared.a  "${STRAP_ROOTFS}/usr/lib"

ln -sf /tools/usr/lib/ld-linux-${STRAP_ARCH}.so.1 "${STRAP_ROOTFS}/usr/lib"

# strip temporary prefix
for file in libstdc++.la libssp.la libssp_nonshared.la
do
    msg "Stripping prefix of ${file}"
    sed -e 's/tools/usr/' ${STRAP_ROOTFS}/tools/usr/lib/$file > "${STRAP_ROOTFS}/usr/lib/$file"
done
unset file
